# **Augmentation**
 
API для сервиса аугментации изображений

---

## **Содержание**
1. [Описание проекта](#описание-проекта)
2. [Установка зависимостей](#установка-зависимостей)
3. [Запуск Docker-контейнеров](#запуск-docker-контейнеров)
4. [Применение миграций](#применение-миграций)
5. [Запуск тестов](#запуск-тестов)

---

## **Описание проекта**

Проект разработан для выполнения тестового задания на позицию python backend разработчик.

ТЗ кратко:
>Необходимо написать API для сервиса аугментации изображений (реализация FastAPI).
 пользователь сначала регистрируется в системе (если не зарегистрирован),
 затем авторизуется в системе. Главным образом пользователь будет отправлять
 изображения для получения соответствующих трансформировнных его копий.
 На каждое изображение должны быть следующие преобразования:
поворот на 90 градусов;
преобразование из пространства RGB в Space Gray;
изменение размера изображения в 2 раза с сохранением пропорций.

Полный текст ТЗ:
https://github.com/TochkaAI/python-test-assigment

Проект протестирован на debian 12 и centos 10.

Технологии:
- **Backend**: FastAPI + ORM SQLAlchemy
- **База данных**: PostgreSQL
- **Фоновые задачи**: Celery + Redis
- **Контейнеризация**: Docker + docker-compose
- **Миграции**: Alembic
- **S3 хранилище**: Minio

---

## **Установка зависимостей**

Так как проект запускается в контейнерах, то для запуска нужен docker и docker-compose.

Для начала клонируйте репозиторий:

```bash
git clone https://github.com/lyintCode/augmentation.git

```

Далее либо запустите install.sh (Debian/Ubuntu | CentOS/RHEL/Fedora), либо установите docker и docker-compose вручную,
согласно инструкциям с оффициальных сайтах.

```bash
chmod +x install.sh
./install.sh
```

Если установка docker происходит впервые, то необходимо добавить пользователя в группу `docker` и перезапустить терминал
 (или прописать команду newgrp)
```bash
sudo usermod -aG docker $USER

# Для запуска новой оболочки с измененной основной группой
newgrp docker
```

Скрипт `install.sh` установит все зависимости автоматически.

## **Запуск Docker-контейнеров**

Для начала необходимо создать и заполнить .env файл в корне проекта  
Пример .env файла можно посмотреть в .env.example

Так как это тестовый проект, я заполнил .env.example стандартными данными

Так что для работы приложения достаточно скопировать .env

```bash
# В install.sh .env уже скопирован
cp .env.example .env
```

Далее разворачиваем контейнеры

```bash
# Запуск в терминале
docker-compose up --build

# ИЛИ запуск в режиме демона
docker-compose up -d --build

# Команда для остановки контейнеров
docker-compose down
```

После успешного развертывания всех контейнеров, протестировать приложение можно по адресу

http://localhost:8000/docs/

или

запустить автоматический скрипт
```bash
chmod +x ./demo.sh
./demo.sh
```

Скрипт *demo.sh* использует curl что бы проверить работу приложения с тестовым изображением `test_image.png`
 в корне проекта

## **Применение миграций**
env.py файл в папке migrations уже создан и заполнен  
Сами миграции применяются автоматически при запуске в контейнере внутри файла entrypoint.sh

## **Запуск тестов**
Для запуска тестов необходимо развернуть виртуальное окружение

```bash
# Должен быть установлен пакет python3-venv
python3 -m venv .venv
source .venv/bin/activate

# Устанавливаем зависимости
pip install --upgrade pip
pip install -r requirements.txt
```

Запуск тестов
```bash
pytest
```

Так же можно запустить mypy для проверки типизации
```bash
mypy .
```

